<!DOCTYPE html>
<html>

<head>
    <title>Text Encryption and Decryption</title>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Include Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>

<body>

    <div class="container mt-5">
        <h2 class="mb-4">Text Encryption and Decryption</h2>
        <div class="form-group">
            <label for="encryptionKey">Encryption Key:</label>
            <input type="text" class="form-control" id="encryptionKey">
        </div>
        <div class="form-group">
            <label for="operation">Select Operation:</label>
            <select class="form-control" id="operation">
                <option value="encrypt">Encrypt</option>
                <option value="decrypt">Decrypt</option>
            </select>
        </div>
        <div class="form-group">
            <label for="message">Message:</label>
            <textarea class="form-control" rows="4" id="message"></textarea>
        </div>
        <button type="button" class="btn btn-primary" onclick="performOperation()">Perform Operation</button>
        <div class="mt-4">
            <strong>Result:</strong>
            <button type="button" class="btn btn-link float-right" id="copyButton" onclick="copyToClipboard()">
                <i class="fas fa-copy"></i> Copy
            </button>
            <div class="align-items-center border p-2">
                <div style="word-wrap: break-word;" id="result"></div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Toast -->
    <div class="toast" id="copyToast" style="position: absolute; top: 20px; right: 20px;">
        <div class="toast-header">
            <strong class="mr-auto">Copied</strong>
            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast">&times;</button>
        </div>
        <div class="toast-body">
            Text copied to clipboard!
        </div>
    </div>

    <script>
        const ciphering = "AES-CTR";
        const encryption_iv = '1234567891011121';

        function performOperation() {
            var operation = document.getElementById("operation").value;
            var encryptionKey = document.getElementById("encryptionKey").value;
            var message = document.getElementById("message").value;

            if (operation === "encrypt") {
                encrypt(message, encryptionKey).then(function (encrypted) {
                    console.log("Encrypted:", encrypted);
                    document.getElementById("result").innerText = "Encrypted: " + encrypted;

                }).catch(function (error) {
                    console.error("Encryption Error:", error);
                    document.getElementById("result").innerText = "Encryption Error: " + error;
                });

            } else if (operation === "decrypt") {
                decrypt(message, encryptionKey).then(function (decrypted) {
                    console.log("Decrypted:", decrypted);
                    document.getElementById("result").innerText = "Decrypted: " + decrypted;

                }).catch(function (error) {
                    console.error("Decryption Error:", error);
                    document.getElementById("result").innerText = "Decryption Error: " + error;
                });
            }
        }

        function copyToClipboard() {
            var resultText = document.getElementById("result").innerText;
            var tempInput = document.createElement("input");
            document.body.appendChild(tempInput);
            tempInput.value = resultText;
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);

            // Show toast
            var toast = document.getElementById("copyToast");
            var bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }


        function encrypt(data, encryption_key) {
            if (encryption_key.length !== 16 && encryption_key.length !== 32) {
                throw new Error("AES key data must be 128 or 256 bits");
            }

            var ciphering = "AES-CTR";
            var options = { name: ciphering, counter: new Uint8Array(16), length: 128 };

            var keyBuffer = new TextEncoder().encode(encryption_key);
            var dataBuffer = new TextEncoder().encode(data);

            var importedKey = window.crypto.subtle.importKey(
                "raw",
                keyBuffer,
                ciphering,
                false,
                ["encrypt"]
            );

            return importedKey.then(function (key) {
                return window.crypto.subtle.encrypt(
                    options,
                    key,
                    dataBuffer
                );
            }).then(function (encryptedData) {
                var encryptedBytes = new Uint8Array(encryptedData);
                var encoded_encryption = btoa(Array.from(encryptedBytes, function (byte) {
                    return String.fromCharCode(byte);
                }).join(''));
                // Remove '/' character from the encoded_encryption
                var sanitized_encoded_encryption = encoded_encryption.replace(/\//g, '');
                return sanitized_encoded_encryption;
            });
        }



        function decrypt(encryptedData, encryption_key) {
       
            if (encryption_key.length !== 16 && encryption_key.length !== 32) {
                throw new Error("AES key data must be 128 or 256 bits");
            }

            var ciphering = "AES-CTR";
            var options = { name: ciphering, counter: new Uint8Array(16), length: 128 };

            var keyBuffer = new TextEncoder().encode(encryption_key);

            // Convert the base64-encoded encrypted data to a Uint8Array
            var encryptedBytes = new Uint8Array(atob(encryptedData).split('').map(function (c) { return c.charCodeAt(0); }));

            var importedKey = window.crypto.subtle.importKey(
                "raw",
                keyBuffer,
                ciphering,
                false,
                ["decrypt"]
            );

            return importedKey.then(function (key) {
                return window.crypto.subtle.decrypt(
                    options,
                    key,
                    encryptedBytes
                );
            }).then(function (decryptedData) {
                var decryptedString = new TextDecoder().decode(decryptedData);
                return decryptedString;
            });
        }

    </script>

    <!-- Include Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</body>

</html>
